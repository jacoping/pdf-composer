<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>PDFlkit Experiments</title>
		<script src="js/pdfkit.js"></script>
		<script src="js/blob-stream.js"></script>
		<style>

			body {
				font-family: sans-serif;
			}
			iframe {
				border: 1px solid black;
				display: block;
			}

			#nome {
				margin: 20px 0;
			}

		</style>
	</head>
	<body>

		<img src="images/logo.jpg" alt="" id="photo" width="300px" height="auto">

		<h1>GENERATORE FUORIPORTA NOVOLI</h1>
		NOME: <input id="nome" type="text" value="Nome Docente">
		<button onclick="aggiorna()">Aggiorna</button>

		<iframe height="600px" width="600px"></iframe>

		<script>

			var iframe = document.querySelector('iframe');
			var loaded = 0;

			// load logo
			var xhr = new XMLHttpRequest();
			xhr.open( "GET", "./images/logo.jpg", true );
			xhr.responseType = "arraybuffer";
			xhr.onload = function( e ) {
				image = this.response;
				loaded = loaded + 1;
				load_pdf();
			};
			xhr.send();

			// load font helvetica black
			var xhr = new XMLHttpRequest();
			xhr.open( "GET", "./fonts/HelveticaNeueLTPro-Blk.otf", true );
			xhr.responseType = "arraybuffer";
			xhr.onload = function( e ) {
				helvetica_black = this.response;
				loaded = loaded + 1;
				load_pdf();
			};
			xhr.send();		

			// load font helvetica light
			var xhr = new XMLHttpRequest();
			xhr.open( "GET", "./fonts/HelveticaNeueLTPro-Lt.otf", true );
			xhr.responseType = "arraybuffer";
			xhr.onload = function( e ) {
				helvetica_light = this.response;
				loaded = loaded + 1;
				load_pdf();
			};
			xhr.send();	


			function load_pdf() {
				if (loaded == 3) {
					aggiorna();
				}
			}

			function aggiorna(){

				var nome = document.querySelector('#nome').value;

				doc = new PDFDocument({
					autoFirstPage: false
				});

				stream = doc.pipe(blobStream())

				doc.addPage({
					size: [400,400],
					margins: {
						top: 10,
						bottom: 10,
						left: 10,
						right: 12
					}
				});


				doc.font(helvetica_black, 30)
					.text(nome, {
					height: 300,
					align: 'right',
					ellipsis: true
				});
				
				doc.font(helvetica_light, 30)
					.text(nome, {
					height: 300,
					align: 'right',
					ellipsis: true
				});
				
				doc.image(image, 10, 10,  {width: 100});


				doc.end();
				stream.on('finish', function() {
					iframe.src = stream.toBlobURL('application/pdf');
				});

			}	





		</script>





	</body>
</html>






























